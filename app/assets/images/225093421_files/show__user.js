(function(a){new odesk.Class("odesk.BaseMuaForm","odesk.AbstractWidget",{options:{selectors:{errorAlert:".errorDialogAlert",rate:"div.rate-content",upfrontPaymentInfo:".upfrontPaymentInfo"},fieldNames:{contractorRate:"contractorRate",employerRate:"employerRate",upfrontPayment:"upfrontPayment",reason:"reason",otherReason:"otherReason",agreement:"agreement"},isFixedJob:false,mua:false,maxHourlyRate:999,maxFixedPrice:45E3,rentPercent:false,validation:{},allowSubmit:true,loadingMessage:"Loading...",testMode:false},
$rate:false,$contractorRate:false,$employerRate:false,$upfrontPayment:false,$upfrontPaymentInfo:false,init:function(b,c,d){this.name=b;this.$element=a(c);a.extend(true,this.options,d);a.extend(true,this.events,odesk.events.makeMap(this.name,["disallow","submit"]))},valid:function(){var b=this.$element.valid();this.options.selectors.errorAlert&&b&&a(this.options.selectors.errorAlert).hide();return b},submit:function(b){this.options.allowSubmit&&this.options.mua?this._muaSubmit(b):this.$element.submit();
return this},allowSubmit:function(b){this.options.allowSubmit=!!b;return this},inlinePlacement:function(b,c){b.insertAfter(c).addClass("inline")},blockPlacement:function(b,c){b.appendTo(c.addClass("hideOk").closest("dd")).css("display","block")},addRate:function(){var b=this.options.fieldNames.contractorRate,c=this.options.fieldNames.employerRate,d={};this.$contractorRate=a('input[name="'+b+'"]',this.$element);this.$employerRate=a('input[name="'+c+'"]',this.$element);if(this.options.selectors.rate){this.$rate=
a(this.options.selectors.rate,this.$element);if(this.options.rentPercent===false){var e=a("span.rentPercent",this.$rate);if(e.length){e=parseFloat(e.text());if(!isNaN(e))this.options.rentPercent=e}}}d[b]={required:true};d[c]={required:true};if(this.options.isFixedJob){d[b]={range:[0.01,this.options.maxFixedPrice]};d[c]={range:[0.01,this.options.maxFixedPrice+odesk.math.feesFromCost(this.options.maxFixedPrice,this.options.rentPercent)]}}else{d[b]={range:[0.01,this.options.maxHourlyRate]};d[c]={range:[0.01,
this.options.maxHourlyRate+odesk.math.feesFromCost(this.options.maxHourlyRate,this.options.rentPercent)]}}e={rules:d,messages:{},groups:{range:b+" "+c},errorPlacements:{}};e.messages[b]={range:a.format("Please enter an amount between {0} and "+odesk.string.groupDigits(d[b].range[1])+"."),maxlength:a.format("Max length should be less then or equal to {0}")};e.messages[c]={range:a.format("Please enter an amount between {0} and "+odesk.string.groupDigits(d[c].range[1])+"."),maxlength:a.format("Max length should be less then or equal to {0}")};
e.errorPlacements[b]=this.blockPlacement;e.errorPlacements[c]=this.blockPlacement;a.extend(true,this.options.validation,e);return this},addAgreement:function(){var b=this;a.validator.addMethod("acceptedAgreement",function(d,e){return b.options.mua&&b.options.mua.enabled?d.toLowerCase()==="accept":a(e).is(":checked")});var c={rules:{},messages:{},errorPlacements:{}};c.rules[this.options.fieldNames.agreement]={acceptedAgreement:true};c.messages[this.options.fieldNames.agreement]={acceptedAgreement:"To apply to this job you need to agree to the oDesk User Agreement"};
c.errorPlacements[this.options.fieldNames.agreement]=this.blockPlacement;a.extend(true,this.options.validation,c);return this},_calculateUpfront:function(){if(this.options.isFixedJob){var b=parseFloat(this.$contractorRate.val().replace(/\,/g,"")),c=parseFloat(this.$upfrontPayment.val()),d=0;if(!isNaN(b)&&!isNaN(c)&&c>0&&c<=100)d=odesk.math.roundToPrecision(b*c/100,2);if(d){b=d+odesk.math.feesFromCost(d,this.options.rentPercent);a(".upfrontPaymentPay",this.$upfrontPaymentInfo).html(odesk.currency.format(d));
a(".upfrontPaymentCharge",this.$upfrontPaymentInfo).html(odesk.currency.format(b));this.$upfrontPaymentInfo.show()}else this.$upfrontPaymentInfo.hide()}},addUpfrontPayment:function(){if(this.options.isFixedJob){if(this.options.fieldNames.upfrontPayment){this.$upfrontPayment=a('input[name="'+this.options.fieldNames.upfrontPayment+'"]',this.$element);this.$upfrontPaymentInfo=a(this.options.selectors.upfrontPaymentInfo,this.$element)}this.$rate&&a("input",this.$rate).bind("keyup focus",a.proxy(function(){this._calculateUpfront()},
this));this.$contractorRate&&this.$upfrontPayment&&this.$upfrontPayment.bind("change keyup",a.proxy(function(){this._calculateUpfront()},this));var b={rules:{},errorPlacements:{}};b.rules[this.options.fieldNames.upfrontPayment]={min:0,max:100};b.errorPlacements[this.options.fieldNames.upfrontPayment]=this.blockPlacement;a.extend(true,this.options.validation,b)}return this},addReason:function(){var b=this;this.$reason=a('select[name="'+this.options.fieldNames.reason+'"]',this.$element);this.$otherReason=
a('input[name="'+this.options.fieldNames.otherReason+'"]',this.$element);this.$otherReasonLine=a("#"+this.options.fieldNames.otherReason+"-element,#"+this.options.fieldNames.otherReason+"-label",this.$element);this.$otherReasonLine.hide();var c={rules:{},errorPlacements:{}};c.rules[this.options.fieldNames.reason]={required:true};c.rules[this.options.fieldNames.otherReason]={required:function(){return b.$reason.val()==b.$reason.attr("rel")}};c.errorPlacements[this.options.fieldNames.reason]=this.blockPlacement;
c.errorPlacements[this.options.fieldNames.otherReason]=this.blockPlacement;a.extend(true,this.options.validation,c);this.$reason.change(function(){if(a(this).val()==a(this).attr("rel")){b.$otherReasonLine.show();b.$otherReason.focus()}else b.$otherReasonLine.hide()}).keyup(function(d){d.which!=9&&d.which!=16&&a(this).change()});return this},initValidation:function(b){this.$element.oFormValidation(a.extend(true,{ignore:"input[type=hidden],:hidden",disabledButtons:"",invalidHandler:a.proxy(function(){this.options.selectors.errorAlert&&
a(this.options.selectors.errorAlert).show()},this),callback:a.proxy(function(){if(!this.options.allowSubmit){this.ctx.mediator.publish(this.events.disallow);return false}this.options.allowSubmit=false;this.showLoading();this.ctx.mediator.publish(this.events.submit);return!this.options.testMode},this)},this.options.validation,b||{}));return this},showLoading:function(b){if(typeof b==="undefined")b=true;var c=typeof odesk.loading.hidden==="undefined"||odesk.loading.hidden;if(b){a("input[type=submit]",
this.$element).prop("disabled",true).addClass("disabled");a("input,select,textarea",this.$element).prop("readonly",true);c&&odesk.loading.show(this.options.loadingMessage,true)}else{a("input[type=submit]",this.$element).prop("disabled",false).removeClass("disabled");a("input,select,textarea",this.$element).prop("readonly",false);c||odesk.loading.hide()}return this},_muaSubmit:function(b){b=b||{};this.showLoading();odesk.ajax({url:odesk.env.API_ROOT+"tos/v1/terms/"+this.options.mua.version+".json",
dataType:"json",type:"POST",data:{accept:true,type:this.options.mua.enabled?"input":"checkbox",input:this.options.mua.enabled?"accept":""},success:b.success||a.proxy(function(){this.$element.submit()},this),error:a.proxy(function(){this.showLoading(false);b.error?b.error():this.allowSubmit.call(this,true)},this)})}})})(jQuery);(function(a){new odesk.Class("odesk.BaseStepDialog","odesk.AbstractWidget",{options:{selectors:{stepItems:".dialogStep",openLink:"",errorAlert:""},dialog:{autoOpen:true,modal:true,resizable:false,width:600},steps:[],openDialogAllowed:true},init:function(b,c,d){this.name=b;this.$element=a(c);a.extend(true,this.options,d);this._prepareContent()._addEvents()},_prepareContent:function(){if(this.options.selectors.errorAlert)this.$errorAlert=a(this.options.selectors.errorAlert,this.$element);else{this.$errorAlert=
a('<ul class="alertBox high errorDialogAlert"><li>Please correct the errors below.</li></ul>').hide();this.$element.prepend(this.$errorAlert)}return this},_addEvents:function(){this.options.selectors.openLink&&a(this.options.selectors.openLink).bind("click",a.proxy(function(){if(this.open()!==false)return false},this));return this},addStep:function(b){this.options.steps.push(b)},beforeOpen:function(){return this.options.openDialogAllowed},afterOpen:function(){a.fn.autogrow&&a("textarea:visible",this.$element).autogrow({lineHeight:16});
a(":input:visible:enabled:first",this.$element).focus()},open:function(b){b=b||0;if(!this.beforeOpen())return false;if(typeof this.options.steps[b]!=="undefined"){b=a.extend({},this.options.dialog,this.options.steps[b],{step:b,open:a.proxy(this.onOpen,this)});if(this.options.steps.length>1){this.$element.find(this.options.selectors.stepItems).hide();this.$element.find(b.stepSelector).show()}var c=this.$element.dialog("isOpen");this.$element.dialog(b);c&&this.onOpen()}},previousStep:function(){this.open(this.$element.dialog("option",
"step")-1)},nextStep:function(){this.open(this.$element.dialog("option","step")+1)},onOpen:function(){this.$element.find("div.errors,ul.errors").filter(":not(.valid):visible").length?this.$errorAlert.show():this.$errorAlert.hide();var b=this.$element.dialog("widget").parent().find("div.ui-dialog-buttonpane");b.find("a").remove();b.append('<a class="canceDialoglLink">Cancel</a>');b.delegate("a.canceDialoglLink","click",a.proxy(function(){this.$element.dialog("close")},this));if(this.$element.dialog("option",
"step")){b.prepend('<a class="stepBackLink">&lsaquo; Back</a>');b.delegate("a.stepBackLink","click",a.proxy(function(){this.$element.dialog("close");this.open(this.$element.dialog("option","step")-1)},this))}b=this.$element.dialog("option","afterOpen");a.isFunction(b)?b.call(this.$element.get(0)):this.afterOpen()}})})(jQuery);odesk.templates.flaggingWidgetContainer='<div id="fo-poll-container" class="isHidden"><b>Flag as inappropriate</b><p class="small" id="fo_note">Tell us why you are flagging this</p><div id="fo_error">Sorry, Flagging is temporarily unavailable</div><div id="img-loader"><img src="/images/winbox_throbber.gif"></div><form method="post" id="fo-poll"><div id="flags-list"></div><div id="flg"><input type="button" value="Submit" id="flaggingSubmit" /><input type="button" value="Cancel" id="flaggingCancel" /></div></form></div>';
odesk.templates.flaggingWidgetFlagsList='{{each type_ids}}<div><input type="checkbox" value="${type_ids[$index]}" id="flagId${type_ids[$index]}" /><label for="flagId${type_ids[$index]}">${flag_names[$index]}</label></div>{{/each}}';odesk.templates.html5FlaggingWidgetContainer='<div class="isHidden"><p>Tell us why you are flagging this</p><div class="jsError isHidden">Sorry, Flagging is temporarily unavailable</div><form class="mbn"><div class="isLoading isHidden"></div><div class="jsFlagsList pbm"></div><div><button class="oBtn oBtnPrimary">Submit</button><button class="oBtn oBtnTertiary jsFlyoutClose">Cancel</button></div></form></div>';
odesk.templates.html5FlaggingWidgetFlagsList='{{each type_ids}}<label for="flagId${type_ids[$index]}" class="oOpt oOptLbl"><input type="checkbox" value="${type_ids[$index]}" id="flagId${type_ids[$index]}">${flag_names[$index]}</label>{{/each}}';(function(a){new odesk.Class("odesk.Flagging","odesk.AbstractWidget",{options:{$triggerElement:a("#fo_link"),submitBtn:"#flaggingSubmit",cancelBtn:"#flaggingCancel",list:"#flags-list",error:"#fo_error",loader:"#img-loader",triggerAction:"click",isRemoteDataNeeded:true},html5Options:{submitBtn:".oBtnPrimary",cancelBtn:".oBtnTertiary",list:".jsFlagsList",error:".jsError",loader:".isLoading",container:".jsFlagging"},init:function(b,c){this.$element=a(b);odesk.pageConfig.isHtml5&&a.extend(this.options,
this.html5Options);a.extend(this.options,c);this._prepareWidgetStuff()},_prepareWidgetStuff:function(){var b=this.$element.next().filter(this.options.container),c;if(b.length)c=this.renderedOnServer=true;else{b=a.tmpl(odesk.templates[odesk.pageConfig.isHtml5?"html5FlaggingWidgetContainer":"flaggingWidgetContainer"]);odesk.pageConfig.isHtml5||this.$element.append(b)}a.extend(this,{$form:b.find("form"),$container:b,$error:b.find(this.options.error),$loader:b.find(this.options.loader),$flagsList:b.find(this.options.list),
$submitButton:b.find(this.options.submitBtn),$cancelButton:b.find(this.options.cancelBtn),ajaxObj:{url:odesk.env.API_ROOT+"hr/v1/flagging.json",type:"get",dataType:"json",data:{flagged_item:"user",flagged_item_id:this.options.userId},error:a.proxy(function(){this._blockUI(false);this.$flagsList.hide();this.$submitButton.hide();odesk.pageConfig.isHtml5?this.$error.removeClass("isHidden"):this.$error.show()},this)}});if(c){this._initFlyout();this._assignHandlers()}else if(this.options.isRemoteDataNeeded)odesk.ajax(a.extend(true,
{},this.ajaxObj,{data:{func:"getFlagList",group_id:this.options.groupId},success:a.proxy(function(d){this.flags=d.type_ids;this.$flagsList.append(a.tmpl(odesk.templates[odesk.pageConfig.isHtml5?"html5FlaggingWidgetFlagsList":"flaggingWidgetFlagsList"],d));odesk.pageConfig.isHtml5&&this._initFlyout();this._assignHandlers()},this)}));else{this._initFlyout();this._assignHandlers()}return this},_initFlyout:function(){this.flyout=new odesk.Flyout(this.$element,this.$container.removeClass("isHidden"))},
_assignHandlers:function(){var b=odesk.pageConfig.isHtml5?this.$element:this.options.$triggerElement.add(this.$cancelButton);this.options.triggerAction=="mouseenter"?b.bind(this.options.triggerAction,a.proxy(this._toggleView,this)).bind("mouseleave",a.proxy(this._toggleView,this)):b.bind(this.options.triggerAction,a.proxy(this._toggleView,this));this.$submitButton.bind("click",a.proxy(this._setFlags,this));return this},_toggleView:function(){if(this.$container.is(":hidden")){if(!this.renderedOnServer){this._blockUI(true);
this._getFlags()}odesk.pageConfig.isHtml5?this.flyout.show():this.$container.slideDown("fast")}else odesk.pageConfig.isHtml5?this.flyout.hide():this.$container.slideUp("fast");return false},_getFlags:function(){odesk.ajax(a.extend(true,{},this.ajaxObj,{data:{func:"getFlag",type_id:this.flags},success:a.proxy(function(b){this.$flagsList.find(":checkbox").prop("checked",false);for(var c=0;c<b.type_ids.length;c++)this.$flagsList.find("#flagId"+b.type_ids[c]).prop("checked",true);this._blockUI(false)},
this)}))},_setFlags:function(){var b=[],c=[];this.renderedOnServer?this._toggleView():this._blockUI(true);this.$flagsList.find(":checkbox").each(function(){var d=a(this);(d.prop("checked")?b:c).push(d.val())});odesk.ajax(a.extend(true,{},this.ajaxObj,{type:"post",data:{http_method:"put",func:"toggleFlag",type_id:b,unset_type_id:c},success:a.proxy(function(){this.renderedOnServer||this._toggleView()},this)}));return false},_blockUI:function(b){if(b){odesk.pageConfig.isHtml5?this.$error.addClass("isHidden"):
this.$error.hide();this.$submitButton.show()}this.$flagsList.toggle(!b);odesk.pageConfig.isHtml5?this.$loader.toggleClass("isHidden",!b):this.$loader.toggle(b);this.$submitButton.add(this.$cancelButton).prop("disabled",b)}})})(jQuery);(function(a){new odesk.Class("odesk.Flyout","odesk.AbstractWidget",{options:{positions:["bottom","top","right","left"],fill:"#fff",cornerRadius:0,vertical:0,shadow:true,trigger:"none",strokeStyle:"#cacaca",shadowOffsetX:3,shadowOffsetY:3,shadowBlur:1,shadowColor:"rgba(0, 0, 0, 0.15)",width:325,padding:0},init:function(b,c,d){this.$element=a(b);this.content=c;a.extend(this.options,d);this._initBt();this._addEvents()},_initBt:function(){var b=this.$flyout=a("<div>").appendTo(document.body).html(odesk.templates.flyout).detach().children();
b.find(".oBd").append(this.content);this.$element.obt(b,a.extend(this.options,{postShow:function(){a.browser.msie&&a.browser.version==8&&setTimeout(function(){b.find(".oBtnClose").html("&nbsp;")},1E3)}}))},_addEvents:function(){this.$flyout.delegate(".jsFlyoutClose","click",a.proxy(this.hide,this))},show:function(){this.$element.obtOn();return this},hide:function(){this.$element.obtOff();return this}})})(jQuery);odesk.templates.flyout='<article class="oFlyout oMed"><div class="oBd"></div></article>';(function(a){new odesk.Class("odesk.PhoneVerification","odesk.AbstractWidget",{options:{link:".jsPV",dialogSelector:"#phoneVerificationDialog",phoneSelector:'[name="phone_selector"]',newPhone:".jsNewPhone",newPhoneFields:".jsNewPhoneFields",voice:".jsVoice",text:".jsText",can:".jsCan",cant:".jsCant",cancel:".jsCancel",back:".jsBack",close:".jsClose",showTicket:".jsShowTicket",error:".jsError",showPhone:".jsShowPhone",isHidden:"isHidden",errorInfo:".jsErrorInfo",errorMsg:".oMsgError",dialog:{autoOpen:false,
modal:true,width:550,resizable:false,minHeight:"auto"},config:odesk.pageConfig.phoneVerification,currentSection:"isCurrent",ticketUrl:"/api/tickets/v1/tickets.json",pvUrl:odesk.env.API_ROOT+"ext/v1/pvs/status/"+odesk.pageConfig.AUSER.uid+".json"},init:function(b){a.extend(true,this.options,b);this.config=this.options.config;this.$dialog=a(this.options.dialogSelector);if(this.$dialog.length){this.current=this.$dialog.children("."+this.options.currentSection).data("id");this._addEvents()}},_addEvents:function(){var b=
this.options;a(document).delegate(b.link,"click",a.proxy(this._open,this));this.$dialog.delegate(b.cancel,"click",a.proxy(function(){this._showSection("cancel");return false},this)).delegate(b.back,"click",a.proxy(function(c){this._showSection(a(c.target).data("back")||this.prevSection);return false},this)).delegate(b.close,"click",a.proxy(function(){this.$dialog.dialog("close");return false},this)).delegate(b.showTicket,"click",a.proxy(function(c){this._setQuestion(a(c.target).data("question"));
this._showSection("ticket");return false},this))},_open:function(b){if(!this.success){b&&b.preventDefault();this.$link=a(b.target);b=this.$dialog;if(!b.data("dialog")){b.dialog(a.extend({beforeClose:a.proxy(function(){if(this.current=="phone"){this._showSection("cancel");return false}else if(this.current=="cancel"||this.current=="ticket")this._showSection(this.prevSection)},this)},this.options.dialog));this._initPhone();this._initPin();this._initPin("reenterPin");this._initTicket();this._initSuccess()}this._showSection(this.current);
b.dialog("open")}},_showSection:function(b){this.prevSection=this.current;this._getSection(this.current).removeClass(this.options.currentSection).hide();this.current=b;this._getSection(b).addClass(this.options.currentSection).show();b="_onShow"+odesk.string.capitalize(b);this[b]&&this[b]()},_getSection:function(b){return this.$dialog.children('[data-id="'+b+'"]')},_initPhone:function(){var b=this._getSection("phone"),c=b.find(this.options.newPhoneFields),d=this.$newPhone=b.find(this.options.newPhone);
b.find(this.options.phoneSelector).bind("change",function(){c.toggle(this==d[0])});var e=b.find("form");e.bind("submit",false);this._initPhoneValidation(e);e.bind("submit",a.proxy(function(){e.valid()&&this._submitPhone(e)},this))},_initPhoneValidation:function(b){this._addRequirePhoneMethod();var c=this.$newPhone;b.oFormValidation({labelErrorClass:"oFormError oFormErrorBottom",rules:{phone_selector:{requirePhone:true},phone_country:{required:function(){return c.prop("checked")}}},errorPlacements:{phone_selector:function(d,
e){d.appendTo(e.closest(".oFormField"))}}})},_addRequirePhoneMethod:function(){a.validator.addMethod("requirePhone",a.proxy(function(){if(!this.$newPhone.prop("checked")&&!this.config.accountPhone)return false;return true},this),"please enter a new number")},_submitPhone:function(b){var c=b.find(this.options.voice).prop("checked"),d;d=this.$newPhone.prop("checked")?a.trim(b.find(".oPhoneCountryCode").val())+" "+a.trim(b.find(".oPhoneAreaCode").val())+" "+a.trim(b.find(".oPhoneNumber").val()):this.config.accountPhone;
var e={phone:d,is_voice:c};if(this.config.status&&this.config.status!="NEEDED"){e.http_method="put";if(d!=this.config.phone||c!=this.config.isVoice){if(!this.config.canChangePhone){this._showPhoneError("You attempted to change your phone number too many times. Please contact customer support.");c=this.config.phone.split(" ");b.find(".oPhoneCountryCode").val(c[0]);b.find(".oPhoneAreaCode").val(c[1]);b.find(".oPhoneNumber").val(c[2]);b.find(":submit").prop("disabled",false);return}e.type="change phone number"}else{if(!this.config.canRequestMessage){this._showPhoneError("You attempted to resend your PIN too many times. Please contact customer support.");
b.find(":submit").prop("disabled",false);return}e.type="resend pin"}}this._submit(b,{url:this.options.pvUrl,data:e,success:a.proxy(function(f){this._hidePhoneError();if(f.pv_error_id=="DUPLICATE")this._showSection("duplicate");else{this.config.isVoice=f.pv_is_voice;this.config.canRequestMessage=f.pv_can_request_message;this.config.canChangePhone=f.pv_can_change_phone;this.config.status=f.pv_status;this.config.phone=f.pv_phone;this._showSection("pin")}},this),error:a.proxy(function(f){this._hidePhoneError();
if(f.status==400)if((f=JSON.parse(f.responseText).error)&&f.message=="Bad Request: Invalid parameter phone"){this._showPhoneError("The phone number you entered seems to be invalid format");return true}},this)})},_setError:function(b){var c=this._getSection("error");c.find(this.options.errorMsg).html(b.message);c.find(this.options.errorInfo).html(b.info)},_showPhoneError:function(b){this._getSection("phone").find(this.options.error).html(b).show()},_hidePhoneError:function(){this._getSection("phone").find(this.options.error).hide()},
_initPin:function(b){b=b||"pin";b=this._getSection(b);b.find(this.options.showPhone).bind("click",a.proxy(function(){this._showSection("phone")},this));var c=b.find("form").bind("submit",a.proxy(function(){c.valid()&&this._submitPin(c);return false},this));this._initPinValidation(c)},_initPinValidation:function(b){b.oFormValidation({rules:{pin_code:"required"}})},_submitPin:function(b){var c=a.trim(b.find('[name="pin_code"]').val());this._submit(b,{url:this.options.pvUrl,data:{http_method:"put",type:"new pin attempt",
param:c},success:a.proxy(function(d){this.config.isVoice=d.pv_is_voice;this.config.canRequestMessage=d.pv_can_request_message;this.config.canChangePhone=d.pv_can_change_phone;this.config.status=d.pv_status;switch(d.pv_status){case "PIN_ERROR":this._showSection("reenterPin");break;case "VERIFIED":this._showSection("success");break;case "PIN_FAILED":this._setError({message:"Too many attempts to enter PIN",info:'Please, contact <a href="/support.php?cat=API_PHONE_VERIFICATION" target="_blank">support</a>'});
this._showSection("error");break;case "EXPIRED":this._setError({message:"Your phone verification has been expired",info:'Please, contact <a href="/support.php?cat=API_PHONE_VERIFICATION" target="_blank">support</a>'});this._showSection("error");break}},this),complete:function(){b[0].reset()}})},_onShowPin:function(){var b=this._getSection(this.current),c=this.config.isVoice,d=this.options,e=d.isHidden;b.find(d.voice).each(function(){a(this).toggleClass(e,!c)});b.find(d.text).each(function(){a(this).toggleClass(e,
c)});var f=this.config.canRequestMessage;b.find(d.can).each(function(){a(this).toggleClass(e,!f)});b.find(d.cant).each(function(){a(this).toggleClass(e,f)})},_setQuestion:function(b){this._getSection("ticket").find("textarea").val(b)},_initTicket:function(){var b=this._getSection("ticket").find("form");b.bind("submit",false);this._initTicketValidation(b);b.bind("submit",a.proxy(function(){b.valid&&this._submitTicket(b)},this))},_initTicketValidation:function(b){b.oFormValidation({labelErrorClass:"oFormError oFormErrorBottom",
rules:{ticket_subject:"required",ticket_question:"required"},messages:{ticket_subject:"Please, enter subject",ticket_question:"Please, enter your question"}})},_submitTicket:function(b){var c=odesk.pageConfig.AUSER;this._submit(b,{url:this.options.ticketUrl,data:{username:c.uid,name:c.first_name+" "+c.last_name,message:b.find('[name="ticket_subject"]').val()+"\n"+b.find("textarea").val(),priority:b.find("select").val(),topic_api_ref:"API_PHONE_VERIFICATION",email:this.config.email},success:a.proxy(function(){this.$dialog.dialog("close")},
this)})},_submit:function(b,c){odesk.loading.show(null,true);var d=c.error,e=c.complete;delete c.error;delete c.complete;odesk.ajax(a.extend({type:"post",error:a.proxy(function(){if(d)if(d=d())return;this._setError({message:"Unknown server error occured.",info:'Please, contact <a href="/support.php?cat=API_PHONE_VERIFICATION" target="_blank">support</a>'});this._showSection("error")},this),complete:a.proxy(function(){odesk.loading.hide();b.find(":submit").prop("disabled",false);e&&e()},this)},c))},
_onSuccessShow:function(){this.success=true},_initSuccess:function(){this._getSection("success").find("button").bind("click",a.proxy(function(){this.$dialog.dialog("close");var b=this.$link,c=b.attr("href");if(c&&c!="#")location.href=c;else b.click()},this))}});odesk.preLoadedWidgets.phoneVerification=new odesk.PhoneVerification;if(!odesk.pageConfig.isHtml5){jQuery.fn.forceNumericOnly=function(){return this.each(function(){a(this).keydown(function(b){b=b.charCode||b.keyCode||0;return b==8||b==9||
b==46||b>=37&&b<=40||b>=48&&b<=57||b>=96&&b<=105})})};jQuery.fn.pvWizardData={showLoading:function(){odesk.loading.show("Loading ...",true)},hideLoading:function(){odesk.loading.hide()}};jQuery.fn.pvErrorTooltip=function(b){return this.each(function(){a("#phone_verification_dialog .field-error").removeClass("field-error").unbind("focus");a("#phone_verification_dialog #errorToolTip").remove();if(b){var c=a(this).position();a('<div id="errorToolTip">').css({top:c.top+a(this).height()+10,left:c.left-
15,display:"none"}).html(b).appendTo("#phone_verification_dialog").show("slow");a(this).addClass("field-error").bind("focus",function(){a(this).pvErrorTooltip()})}})};jQuery.fn.pvWizard=function(b,c){c||(c={});return this.each(function(){if(b&&a("#phone_verification_dialog .phone-verification-page#"+b).length){a("#phone_verification_dialog .field-error").pvErrorTooltip();a(this).dialog({title:"Verify Your Phone Number",autoOpen:false,modal:true,width:560,minWidth:560,minHeight:300,resizable:false,
dialogClass:"ui-phone-verification-dialog",draggable:true}).unbind("dialogbeforeclose").bind("dialogbeforeclose",function(){a(this).pvWizard("pageCancel",{pageBack:b});return false});switch(b){case "pageOne":a("#custom_phone_selector,#account_phone_selector",this).unbind("change").bind("change",function(){a("#phone_verification_dialog .field-error").pvErrorTooltip();a("#phone_verification_dialog #use_new_number").toggle(a("#phone_verification_dialog #custom_phone_selector").is(":checked"))});a("#phone_country",
this).unbind("change").bind("change",function(){a("#phone_verification_dialog .field-error").pvErrorTooltip();a("#phone_verification_dialog #phone_country_code").val(a(this).val().split("_")[1])}).change();jQuery.fn.pvWizardData.oldCountryCode=a(".phone-country",this).val();a(this).dialog("option","buttons",{Cancel:function(){a(this).dialog("close")},Continue:function(){if(a("#account_phone_selector",this).is(":checked")&&!/^\d{1,5}\s\d{1,5}\s\d{1,15}$/.test(a("#account_phone",this).val().trim())){a("#custom_phone_selector",
this).prop("checked",true).change();var e=a("#account_phone",this).val().split(" ");switch(e.length){case 1:a(".phone-area",this).val("");a(".phone-number",this).val("");break;case 2:a(".phone-area",this).val("");a(".phone-number",this).val(e[1]);break;case 3:a(".phone-area",this).val(e[1]);a(".phone-number",this).val(e[2]);break}}if(a("#custom_phone_selector",this).is(":checked")){if(!a(".phone-country",this).val().split("_")[1]){a(".phone-country",this).pvErrorTooltip("Please, select your country from the list");
return}if(!/^\d{1,5}$/.test(a(".phone-area",this).val())){a(".phone-area",this).pvErrorTooltip("Area code must be 1-5 numbers long");return}if(a(".phone-country",this).val().split("_")[1]==1&&a(".phone-area",this).val().length<3){a(".phone-area",this).pvErrorTooltip("Area code must be at least 3 digits");return}if(!/^\d{1,15}$/.test(a(".phone-number",this).val())){a(".phone-number",this).pvErrorTooltip("Phone number must be 1-15 numbers long");return}}e={phone:a("#account_phone_selector",this).is(":checked")?
a("#account_phone",this).val().trim():a(".phone-country",this).val().split("_")[1]+" "+a(".phone-area",this).val()+" "+a(".phone-number",this).val(),is_voice:a("#delivery_method_voice",this).is(":checked")};var f="/api/ext/v1/pvs/status/"+jQuery.fn.pvWizardData.auser.uid+".json";if(jQuery.inArray(a("#pv_status",this).val(),["","NEEDED"])==-1){e.http_method="put";if(e.phone!=a("#phone_verification_dialog #pv_phone").val()||e.is_voice.toString()!=a("#phone_verification_dialog #pv_is_voice").val()){if(a("#phone_verification_dialog #pv_can_change_phone").val()==
"false"){alert("You attempted to change your phone number too many times. Please contact customer support.");e=a("#phone_verification_dialog #pv_phone").val().split(" ");a(".phone-country",this).val(jQuery.fn.pvWizardData.oldCountryCode);a(".phone-area",this).val(e[1]);a(".phone-number",this).val(e[2]);a("#account_phone",this).val()==a("#pv_phone",this).val()?a("#account_phone_selector",this).prop("checked",true).change():a("#custom_phone_selector",this).prop("checked",true).change();return}e.type=
"change phone number"}else{if(a("#phone_verification_dialog #pv_can_request_message").val()=="false"){alert("You attempted to resend your PIN too many times. Please contact customer support.");return}e.type="resend pin"}}var g=a(".ui-phone-verification-dialog .ui-dialog-buttonpane button:last");g.addClass("ui-state-disabled").prop("disabled",true);jQuery.fn.pvWizardData.showLoading();a.ajax({type:"POST",url:f,data:e,error:function(h){g.removeClass("ui-state-disabled").prop("disabled",false);jQuery.fn.pvWizardData.hideLoading();
if(h.status==400){h=a.parseJSON(h.responseText);if(h.error&&h.error.message&&h.error.message=="Bad Request: Invalid parameter phone"){alert("The phone number you entered seems to be invalid format");return}}a("#phone_verification_dialog").pvWizard("pageError",{error_message:"Unknown server error occured.",error_info:'Please, contact <a href="/support.php?cat=API_PHONE_VERIFICATION" target="_blank">support</a>'})},success:function(h){g.removeClass("ui-state-disabled").prop("disabled",false);jQuery.fn.pvWizardData.hideLoading();
if(h.pv_error)h.pv_error_id=="DUPLICATE"&&a("#phone_verification_dialog").pvWizard("pageDuplicate");else{a("#phone_verification_dialog .request-new-pin-block").toggle(h.pv_can_request_message||h.pv_can_change_phone);if(!h.pv_can_change_phone&&!h.pv_can_request_message){a("#phone_verification_dialog .request-new-block").hide();a("#phone_verification_dialog .no-pin-ticket-block").show()}a("#phone_verification_dialog #pv_status").val(h.pv_status);a("#phone_verification_dialog #pv_phone").val(h.pv_phone);
a("#phone_verification_dialog #pv_is_voice").val(h.pv_is_voice.toString());a("#phone_verification_dialog #pv_can_request_message").val(h.pv_can_request_message.toString());a("#phone_verification_dialog #pv_can_change_phone").val(h.pv_can_change_phone.toString());a("#phone_verification_dialog").pvWizard("pageEnterPIN")}}})}});break;case "pageDuplicate":a(".ticket-close-account-link",this).unbind("click").bind("click",function(){a("#phone_verification_dialog").pvWizard("pageTicket",{pageBack:b,ticketQuestion:"When verifying my phone number, oDesk believes there are two accounts with this number. I would like to close one of these accounts."})});
a(".ticket-unknown-account-link",this).unbind("click").bind("click",function(){a("#phone_verification_dialog").pvWizard("pageTicket",{pageBack:b,ticketQuestion:"When verifying my phone number, oDesk believes there are two accounts with this number. This is my real number and I do not believe this to be true."})});a(this).dialog("option","buttons",{"Go Back":function(){a("#phone_verification_dialog").pvWizard("pageOne")}});break;case "pageEnterPIN":case "pageReenterPIN":a(".selected-method-text",this).toggle(a("#pv_is_voice",
this).val()!="true");a(".selected-method-voice",this).toggle(a("#pv_is_voice",this).val()=="true");a(".request-new-pin-link",this).unbind("click").bind("click",function(){a("#phone_verification_dialog").pvWizard("pageOne")});a(".ticket-no-pin-link",this).unbind("click").bind("click",function(){a("#phone_verification_dialog").pvWizard("pageTicket",{pageBack:"pageEnterPIN",ticketQuestion:"I requested a PIN to my phone number and never received the PIN. This happened twice."})});a("#"+b+" #pin_code",
this).unbind("keydown").bind("keydown",function(e){(e.charCode||e.keyCode||0)==13&&a(".ui-phone-verification-dialog .ui-dialog-buttonpane button:last").click();return true});a("#"+b+" #pin_code",this).val("");a(this).dialog("option","buttons",{Cancel:function(){a(this).dialog("close")},"Validate my PIN":function(){var e={http_method:"put",type:"new pin attempt",param:a("#"+b+" #pin_code",this).val()};if(e.param){var f=a(".ui-phone-verification-dialog .ui-dialog-buttonpane button:last");f.addClass("ui-state-disabled").prop("disabled",
true);jQuery.fn.pvWizardData.showLoading();a.ajax({type:"POST",url:"/api/ext/v1/pvs/status/"+jQuery.fn.pvWizardData.auser.uid+".json",data:e,error:function(){f.removeClass("ui-state-disabled").prop("disabled",false);jQuery.fn.pvWizardData.hideLoading();a("#phone_verification_dialog").pvWizard("pageError",{error_message:"Unknown server error occured.",error_info:'Please, contact <a href="/support.php?cat=API_PHONE_VERIFICATION" target="_blank">support</a>'})},success:function(g){f.removeClass("ui-state-disabled").prop("disabled",
false);jQuery.fn.pvWizardData.hideLoading();a("#phone_verification_dialog .request-new-pin-block").toggle(g.pv_can_request_message||g.pv_can_change_phone);if(!g.pv_can_change_phone&&!g.pv_can_request_message){a("#phone_verification_dialog .request-new-block").hide();a("#phone_verification_dialog .no-pin-ticket-block").show()}a("#phone_verification_dialog #pv_status").val(g.pv_status);a("#phone_verification_dialog #pv_phone").val(g.pv_phone);a("#phone_verification_dialog #pv_is_voice").val(g.pv_is_voice.toString());
a("#phone_verification_dialog #pv_can_request_message").val(g.pv_can_request_message.toString());a("#phone_verification_dialog #pv_can_change_phone").val(g.pv_can_change_phone.toString());switch(g.pv_status){case "PIN_ERROR":a("#phone_verification_dialog").pvWizard("pageReenterPIN");break;case "VERIFIED":a("#phone_verification_dialog").pvWizard("pageSuccess");break;case "PIN_FAILED":a("#phone_verification_dialog").pvWizard("pageError",{error_message:"Too many attempts to enter PIN",error_info:'Please, contact <a href="/support.php?cat=API_PHONE_VERIFICATION" target="_blank">support</a>'});
break;case "EXPIRED":a("#phone_verification_dialog").pvWizard("pageError",{error_message:"Your phone verification has been expired",error_info:'Please, contact <a href="/support.php?cat=API_PHONE_VERIFICATION" target="_blank">support</a>'});break}}})}else a("#"+b+" #pin_code",this).pvErrorTooltip("Please, enter PIN code")}});break;case "pageTicket":c.ticketQuestion&&a("#pageTicket",this).data("ticketQuestion",c.ticketQuestion);c.pageBack&&a("#pageTicket",this).data("pageBack",c.pageBack);a("#pageTicket #back_link",
this).unbind("click").bind("click",function(){a("#phone_verification_dialog").pvWizard(a("#phone_verification_dialog #pageTicket").data("pageBack"))});a("#pageTicket .ticket-question",this).val(a("#pageTicket",this).data("ticketQuestion"));a(this).dialog("option","buttons",{Cancel:function(){a(this).dialog("close")},"Send to Customer Support":function(){if(a("#pageTicket .ticket-subject",this).val())if(a("#pageTicket .ticket-question",this).val())if(a("#pageTicket .ticket-severity",this).val()){var e=
{username:jQuery.fn.pvWizardData.auser.uid,name:jQuery.fn.pvWizardData.auser.cn,message:a("#pageTicket .ticket-subject",this).val()+"\n"+a("#pageTicket .ticket-question",this).val(),priority:a("#pageTicket .ticket-severity",this).val(),topic_api_ref:"API_PHONE_VERIFICATION",email:a("#user_email",this).val()},f=a(".ui-phone-verification-dialog .ui-dialog-buttonpane button:last");f.addClass("ui-state-disabled").prop("disabled",true);jQuery.fn.pvWizardData.showLoading();a.ajax({type:"POST",url:"/api/tickets/v1/tickets.json",
data:e,error:function(){f.removeClass("ui-state-disabled").prop("disabled",false);jQuery.fn.pvWizardData.hideLoading();a("#phone_verification_dialog").pvWizard("pageError",{error_message:"Unknown server error occured.",error_info:'Please, contact <a href="/support.php?cat=API_PHONE_VERIFICATION" target="_blank">support</a>'})},success:function(){f.removeClass("ui-state-disabled").prop("disabled",false);jQuery.fn.pvWizardData.hideLoading();alert("Ticket was sent to customer support. Press OK to close");
a("#phone_verification_dialog .current-page").removeClass("current-page");a("#phone_verification_dialog #"+a("#phone_verification_dialog #pageTicket").data("pageBack")).addClass("current-page");a("#phone_verification_dialog").unbind("dialogbeforeclose").dialog("close")}})}else a("#pageTicket .ticket-severity",this).pvErrorTooltip("Please, select a severity");else a("#pageTicket .ticket-question",this).pvErrorTooltip("Please, enter your question");else a("#pageTicket .ticket-subject",this).pvErrorTooltip("Please, enter subject")}});
break;case "pageError":var d={};if(c){a("#error_message",this).html(c.error_message);a("#error_info",this).html(c.error_info);if(c.pageBack)jQuery.fn.pvWizardData.error_pageBack=c.pageBack}if(jQuery.fn.pvWizardData.error_pageBack)d.Back=function(){a(this).pvWizard(jQuery.fn.pvWizardData.error_pageBack)};d.Close=function(){a(this).unbind("dialogbeforeclose").dialog("close")};a(this).dialog("option","buttons",d);break;case "pageSuccess":a(this).dialog("option","buttons",{Close:function(){a("#phone_verification_dialog .current-page").removeClass("current-page");
a(this).dialog("close");if(typeof a(jQuery.fn.pvWizardData.button).data("events")!="undefined"&&a(jQuery.fn.pvWizardData.button).data("events").click)a(jQuery.fn.pvWizardData.button).trigger("click");else window.location.href=a(jQuery.fn.pvWizardData.button).prop("href")}}).unbind("dialogbeforeclose");break;case "pageCancel":a(this).dialog("option","buttons",{"Yes, I want to leave":function(){a(".current-page",this).removeClass("current-page");a("#"+c.pageBack,this).addClass("current-page");a(this).unbind("dialogbeforeclose").dialog("close")},
"No, Back to Verification":function(){a(this).pvWizard(c.pageBack)}}).unbind("dialogbeforeclose").bind("dialogbeforeclose",function(){a(this).pvWizard(c.pageBack)});break}a(".phone-verification-page",this).hide();a(".current-page",this).removeClass("current-page");a("#"+b,this).addClass("current-page").show();a(this).dialog("open")}})};if(typeof odesk!="undefined"&&odesk.pageConfig.AUSER)jQuery.fn.pvWizardData.auser=odesk.pageConfig.AUSER;jQuery.fn.pvWizardData.auser&&a("a.pvLinkButton").live("click",
function(){var b=a("#phone_verification_dialog .current-page:first");if(b.length){a("#phone_verification_dialog").pvWizard(b[0].id);jQuery.fn.pvWizardData.button=this;return false}return true});a("#phone_verification_dialog .numeric-only").forceNumericOnly()}})(jQuery);(function(a){for(var b=["oPhoneNumber","oPhoneCountryCode","oPhoneAreaCode"],c=0;c<3;c++)a.validator.addClassRules(b[c],{phone:true});a.validator.initClassRules.oPhoneNumber=function(e){var f=e.data("country-code");if(f){var g=e.parent().find(".oPhoneCountryCode"),h=a(e[0].form).find(e.data("country")).bind("change",function(){g.val(h.find(":selected").data(f)).focusout()});g.val()||h.change()}};var d=function(e,f){odesk.pageConfig.isHtml5?e.parent().find(".oPhoneCountryCode, .oPhoneAreaCode").toggleClass("oErrorField",
!f):a("#phone_country_code, #phone_area_code")[a("#phone_number").hasClass("errors")?"addClass":"removeClass"]("errors")};odesk.pageConfig.isHtml5||a(document).ready(function(){a("#phone_number").bind("keyup focusin focusout",function(){setTimeout(d,0)});a("#phone_country_code, #phone_area_code").bind("focus",function(){a("#phone_number").focusin().removeClass("focus")}).bind("blur",function(){a("#phone_number").focusout()}).bind("keyup",function(){a("#phone_country_code").val()+a("#phone_area_code").val()+
a("#phone_number").val()&&a("#phone_number").data("modified",true);a("#phone_number").keyup()})});a.validator.addMethod("phone",function(e,f){var g=a(f);if(!g.is(":visible"))return true;var h=g.parent();if(g.is(".oPhoneAreaCode, .oPhoneCountryCode")){setTimeout(function(){h.find(".oPhoneNumber").valid()},0);return"dependency-mismatch"}var i,j,m;if(odesk.pageConfig.isHtml5){i=h.find(".oPhoneCountryCode");j=h.find(".oPhoneAreaCode");m=g}else{i=a("#phone_country_code");j=a("#phone_area_code");m=a("#phone_number")}var k=
a.trim(i.val())+a.trim(j.val())+a.trim(m.val());if(i.length&&!a.trim(i.val())||j.length&&!a.trim(j.val())||!a.trim(m.val())){a.validator.messages.phone="all phone parts are required";d(g,false);return false}if(/\D/.test(k)){a.validator.messages.phone="only numbers are allowed";d(g,false);return false}i=k.length;if(i>5&&i<21){d(g,true);return true}else{a.validator.messages.phone="Phone should include from 6 to 20 digits";d(g,false);return false}},"Phone should include from 6 to 20 digits");odesk.pageConfig.isHtml5||
a.extend(true,a.validator.defaults,{rules:{phone_number:{phone:true}},messages:{phone_number:{}}})})(jQuery);odesk.templates.messageComposeDialog='<div id="compose-mail_form" class="mail_form popup"><table><colgroup><col width="80" /><col width="520" /></colgroup><tr><td><strong>{{if hasBcc}}<input type="radio" value="false" checked="" name="separate_threads" id="to"><label for="to">To:</label><br /><input type="radio" value="true" name="separate_threads" id="bcc"><label for="bcc">Bcc:</label>{{else}}To:{{/if}}</strong></td><td><span id="test_input_token_hidden" style="position: absolute; left: -5000px; top: -5000px;"></span>{{if !$.isEmptyObject(team)}}<div>{{tmpl(team) "filterTokenTeam"}}{{else}}<div id="tokens_pane">{{each(i,recipient) recipients}}{{tmpl(recipient) "filterToken"}}{{/each}}<input type="text" id="recipients_input" name="recipients_input" size="15" value="" />{{/if}}</div><input id="recipients" name="recipients" type="hidden" value="" /></td></tr><tr><td><strong>Subject:</strong></td><td><input id="subject" name="subject" value="${subject}" /></td></tr></table><div><strong>Message:</strong></div><textarea name="body"></textarea><div id="dialogAttachmentsContainer"></div></div>';
odesk.templates.filterToken='<div class="token" id="token_${id}"><span class="token_name">${name}</span><span class="close_token tooltip" tip="Remove from list">x</span></div>';odesk.templates.filterTokenTeam='<div class="token" id="token_${reference}"><span class="token_name">${name}</span></div>';odesk.templates.messageComposeForm='<div id="inbox_reply_form"><h2>${title}</h2><textarea rows="7" class="body" name="body" id="body"></textarea><div id="formAttachmentsContainer"></div><input type="button" value="Send" id="inbox_reply" class="formButton primary small"/></div>';
odesk.templates.attachmentUpload='<div class="attachment"><div class="attachment-label nowrap">{{if first}}File attachment{{else}}Another attachment{{/if}}</div><input type="file" name="attachment" id="attachmentFile" class="attachment-file" /><span class="instructions">(up to 5MB)</span><input type="hidden" name="MAX_FILE_SIZE" value="5242880" /></div>';odesk.templates.uploading='<span id="uploading">Uploading&hellip; <span class="link" id="cancel_upload">Cancel</span></span>';
odesk.templates.attachment='<span id="attachmentKey_${key}">${name} (${size})<span class="attachment-delete" title="Delete this attachment">&nbsp;</span></span>';(function(a){new odesk.Class("odesk.AttachmentUpload","odesk.AbstractWidget",{options:{template:"attachmentUpload",uploadingTemplate:"uploading",attachmentTemplate:"attachment",uploadStatus:"",attachmentsMaxCount:-1},attachmentKeys:[],init:function(b,c,d){this.name=b;this.$element=a(c);this.options=a.extend(this.options,d);a.extend(this.events,odesk.events.makeMap(this.name,["upload"]));this.$element.empty();this._render()},_render:function(){a.template(this.options.template,odesk.templates[this.options.template]);
a.template(this.options.uploadingTemplate,odesk.templates[this.options.uploadingTemplate]);a.template(this.options.attachmentTemplate,odesk.templates[this.options.attachmentTemplate]);this._draw()},_draw:function(){if(this.options.attachmentsMaxCount===0||this.options.attachmentsMaxCount>0&&this.attachmentKeys.length>=this.options.attachmentsMaxCount)this.options.noAnotherAttachmentField=true;else{this.options.noAnotherAttachmentField=false;this.$element.append(a.tmpl(this.options.template,{first:this.attachmentKeys.length===
0}));this.$attachment=this.$element.find("div.attachment:last");var b=this;this.$attachment.find("#attachmentFile").bind("change",function(){b._uploadAttachment()})}},_uploadAttachment:function(){if(this.options.uploadStatus=="started")return false;this.ctx.mediator.publish(this.events.upload);this.options.uploadStatus="started";this.$attachment.find(":gt(0)").hide();this.$attachment.append(a.tmpl(this.options.uploadingTemplate));var b=this;a("#cancel_upload").click(function(){b.options.uploadStatus=
"canceled";b.$attachment.remove();b._draw()});a.ajaxFileUpload({url:odesk.env.API_ROOT+"files/v1/tmp.xhtml",secureuri:false,fileElementId:"attachmentFile",dataType:"html",error:function(c,d){d=="timeout"?(new odesk.Showbox({type:"error",title:"Attachment",message:"Uploading error: Connection timeout. Please try again later",timeout:3E3})).show():(new odesk.Showbox({type:"error",title:"Attachment",message:"Uploading error",timeout:3E3})).show()}})},uploadCallback:function(b){if(this.options.uploadStatus==
"canceled")return false;if(!b||!b.attachment||!b.attachment.key){b.error?(new odesk.Showbox({type:"error",title:"Attachment",message:"Uploading error: "+b.error,timeout:3E4})).show():(new odesk.Showbox({type:"error",title:"Attachment",message:"Uploading error",timeout:3E4})).show();this.options.uploadStatus="error";this.$attachment.remove();this._draw();return false}this.options.uploadStatus="finished";this.attachmentKeys.push(b.attachment.key);this.$attachment.find(":gt(0)").remove();var c=this;
this.$attachment.append(a.tmpl(this.options.attachmentTemplate,b.attachment)).find("span.attachment-delete").click(function(){c._deleteAttachment(a(this).parent())});this._draw()},_deleteAttachment:function(b){var c=b.attr("id").replace(/^attachmentKey_/,""),d,e=this.attachmentKeys.length;for(d=0;d<e;d++)if(this.attachmentKeys[d]==c)break;this.attachmentKeys.splice(d,1);b.parent().remove();this.options.noAnotherAttachmentField&&this._draw()},getUploadStatus:function(){return this.options.uploadStatus},
getAttachmentKeys:function(){return this.attachmentKeys}})})(jQuery);function odesk_upload_callback(a){odesk&&odesk.pageController&&odesk.pageController.attachmentUploadCallback&&odesk.pageController.attachmentUploadCallback(a)};(function(a){new odesk.Class("odesk.MessageComposer","odesk.AbstractWidget",{options:{dialogTemplate:"messageComposeDialog",formTemplate:"messageComposeForm",filterTokenTemplate:"filterToken",filterTokenTeamTemplate:"filterTokenTeam",authUser:odesk.pageConfig.AUSER.uid,useDialog:false,title:"",hasBcc:false,subject:"",recipients:[],team:{},attachmentsMaxCount:-1,dialogOpened:false,maxMessageLength:5E3,composeDialogFormSelector:"#compose-mail_form",composeFormSelector:"#inbox_reply_form",dialogAttachmentsSelector:"#dialogAttachmentsContainer",
formAttachmentsSelector:"#formAttachmentsContainer",sendMessageSelector:"#inbox_reply",recipientsInputSelector:"#recipients_input"},allRecipients:[],selectedRecipients:[],init:function(b,c,d){this.name=b;this.$element=a(c);this.options=a.extend(this.options,d);this.events=odesk.events.makeMap(this.name,["send"]);this._render()},_render:function(){a.template(this.options.dialogTemplate,odesk.templates[this.options.dialogTemplate]);a.template(this.options.formTemplate,odesk.templates[this.options.formTemplate]);
a.template(this.options.filterTokenTemplate,odesk.templates[this.options.filterTokenTemplate]);a.template(this.options.filterTokenTeamTemplate,odesk.templates[this.options.filterTokenTeamTemplate]);this.options.useDialog||this.update({})},updateRecipients:function(b,c){if(!(this.options.dialogOpened&&!c)){this.allRecipients=b;if(this.options.dialogOpened){a(this.options.recipientsInputSelector).unautocomplete();this._autocompleteInit()}}},update:function(b,c){this.options=a.extend(this.options,b);
if(c)this.$element=a(c);if(!this.options.useDialog){this.$element.html(a.tmpl(this.options.formTemplate,{title:this.options.title}));a.fn.autogrow&&a(this.options.composeFormSelector+" textarea",this.$element).autogrow();a(this.options.sendMessageSelector).unbind("click").bind("click",a.proxy(this._composeFormSubmit,this));this.registerWidget("attachmentUploadWidget",new odesk.AttachmentUpload("attachmentUploadWidget",this.options.formAttachmentsSelector,{attachmentsMaxCount:this.options.attachmentsMaxCount}))}},
_composeFormSubmit:function(){if(a(this.options.sendMessageSelector).hasClass("disabled"))return false;var b=[],c=a(this.options.composeFormSelector+" textarea").val();c===""&&b.push("You have to enter a message");if(b.length){alert("Compose message error: \n"+b.join("\n"));return false}if(c.length>this.options.maxMessageLength){alert("Your message can not exceed "+this.options.maxMessageLength+" characters.\nIf you need to post something bigger - pack it and attach to the message");return false}b=
{body:c};a(this.options.sendMessageSelector).addClass("disabled");this._submitMessage(b,this.options.thread)},openWindow:function(b){this.options=a.extend(this.options,b);if(!(this.options.dialogOpened||!this.options.useDialog)){this.selectedRecipients=[];for(b=0;b<this.options.recipients.length;b++)this.selectedRecipients.push(this.options.recipients[b].id);var c=this;a(a.tmpl(this.options.dialogTemplate,{hasBcc:this.options.hasBcc,subject:this.options.subject,team:this.options.team,recipients:this.options.recipients})).dialog({title:this.options.title,
width:622,modal:true,buttons:[{text:"Cancel",click:function(){a(this).dialog("close")}},{text:"Send",click:a.proxy(this._sendMessage,this)}],beforeClose:function(){a(c.options.recipientsInputSelector).trigger("blur")},close:function(){c.options.dialogOpened=false;c.removeWidget("attachmentUploadWidget");a(this).dialog("destroy").remove()},open:function(){a("#subject").focus()}}).delegate(this.options.recipientsInputSelector,"keydown",a.proxy(this._recipientsInputKeyDownHandler,this));this.options.dialogOpened=
true;this.registerWidget("attachmentUploadWidget",new odesk.AttachmentUpload("attachmentUploadWidget",this.options.dialogAttachmentsSelector,{attachmentsMaxCount:this.options.attachmentsMaxCount}));this._postProcess();this._autocompleteInit()}},isWindowOpened:function(){return this.options.dialogOpened},_recipientsInputKeyDownHandler:function(b){if(!a(this.options.recipientsInputSelector).val().length&&(b.charCode||b.keyCode||b.which)==8)a("#tokens_pane div.token:last span.close_token").trigger("click")},
_getFilterToken:function(b){this.selectedRecipients.push(b.id);return a("<div/>").append(a.tmpl(this.options.filterTokenTemplate,b)).html()},_autocompleteInit:function(){var b=this;a(this.options.recipientsInputSelector).autocomplete(this._getAutocompleteList(),{stripSpacesAfterWords:false,multiple:true,matchContains:"word",autoFill:false,scroll:true,scrollHeight:300,width:"200px",formatItem:function(c){return c.name}}).result(function(c,d){a(b.options.recipientsInputSelector).before(b._getFilterToken(d));
a(b.options.recipientsInputSelector).val("").focus();var e=b._getAutocompleteList();e.length?a(this).setOptions({data:e}):a(this).flushCache()})},_getAutocompleteList:function(){var b=[],c,d=this.allRecipients.length;for(c=0;c<d;c++)a.inArray(this.allRecipients[c].id,this.selectedRecipients)==-1&&b.push({id:this.allRecipients[c].id,name:this.allRecipients[c].name});return b},_postProcess:function(){var b=this;a("#tokens_pane").click(function(){a("#tokens_pane div.token").removeClass("active");a(b.options.recipientsInputSelector).focus()});
a("#tokens_pane div.token").live("click",function(){a("#tokens_pane div.token").removeClass("active");a(this).addClass("active");a(b.options.recipientsInputSelector).focus()});a("#tokens_pane span.close_token").live("click",function(){var c=a(this).closest("div.token"),d=c.attr("id").replace(/^token_/,""),e=b.selectedRecipients.length,f;for(f=0;f<e;f++)if(b.selectedRecipients[f]==d)break;b.selectedRecipients.splice(f,1);c.remove();c=b._getAutocompleteList();c.length?a(b.options.recipientsInputSelector).setOptions({data:c}):
a(b.options.recipientsInputSelector).flushCache()})},attachmentUploadCallback:function(b){this.widgets.attachmentUploadWidget.uploadCallback(b)},_sendMessage:function(){a(this.options.composeDialogFormSelector).dialog("disable");var b=[];this.selectedRecipients.length===0&&!this.options.team&&b.push("Please provide list of usernames");this.selectedRecipients.length===1&&this.selectedRecipients[0]==this.options.authUser&&b.push("Please provide some recipient beside yourself");var c=a(this.options.composeDialogFormSelector+
' input[name="subject"]').val();c===""&&b.push("You have to enter a subject");var d=a(this.options.composeDialogFormSelector+" textarea").val();d===""&&b.push("You have to enter a message");if(b.length){alert("Compose message error: \n"+b.join("\n"));a(this.options.composeDialogFormSelector).dialog("enable");return false}if(d.length>this.options.maxMessageLength){alert(odesk.string.sprintf("Your message can not exceed %s characters.\nIf you need to post something bigger - pack it and attach to the message",
this.options.maxMessageLength));a(this.options.composeDialogFormSelector).dialog("enable");return false}b={recipients:this.selectedRecipients.join(", "),team:this.options.team,subject:c,body:d};if(this.options.hasBcc)b.separate_threads=a(this.options.composeDialogFormSelector+' input[name="separate_threads"]:checked').val();this._submitMessage(b)},_submitMessage:function(b,c){var d=this.widgets.attachmentUploadWidget.getUploadStatus();if(d=="started"){odesk.timers.add(5E3,a.proxy(this._submitMessage,
this),[b,c]);return false}else if(d=="error"){c?a(this.options.sendMessageSelector).removeClass("disabled"):a(this.options.composeDialogFormSelector).dialog("enable");return false}d=this.widgets.attachmentUploadWidget.getAttachmentKeys();if(d.length)b["attachment-key"]=d.join(";");odesk.loading.show();var e=this;odesk.ajax({url:this._getSendMessageUrl(c),data:b,type:"post",dataType:"json",rawValues:[-1],success:function(f){odesk.loading.hide();c?a(e.options.sendMessageSelector).removeClass("disabled"):
a(e.options.composeDialogFormSelector).dialog("enable").dialog("close");e.ctx.mediator.publish(e.events.send,f);(new odesk.Showbox({type:"success",title:"Message Sent",message:"Your Message has been successfully sent",timeout:5E3})).show()},error:function(){odesk.loading.hide();c?a(e.options.sendMessageSelector).removeClass("disabled"):a(e.options.composeDialogFormSelector).dialog("enable");(new odesk.Showbox({type:"error",title:"Message",message:"Sending message error",timeout:5E3})).show()}})},
_getSendMessageUrl:function(b){if(a.isEmptyObject(this.options.team))return odesk.env.API_ROOT+"mc/v2/threads/"+odesk.pageConfig.AUSER.uid+(b?"/"+b:"")+".json"+(b?"?escape=html":"");return odesk.env.API_ROOT+"mc/v2/threads/"+odesk.pageConfig.AUSER.uid+"/teams/"+this.options.team.reference+".json"}});a.extend(true,odesk.MessageComposer.prototype,odesk.mediator)})(jQuery);jQuery.extend({createUploadIframe:function(a,b){var c="jUploadFrame"+a;if($.browser.msie&&$.browser.version<8){var d=document.createElement('<iframe id="'+c+'" name="'+c+'" />');if(typeof b=="boolean")d.src="javascript:false";else if(typeof b=="string")d.src=b}else{d=document.createElement("iframe");d.id=c;d.name=c}d.style.position="absolute";d.style.top="-1000px";d.style.left="-1000px";document.body.appendChild(d);return d},createUploadForm:function(a,b){var c="jUploadForm"+a,d="jUploadFile"+a;c=
$('<form  action="" method="POST" name="'+c+'" id="'+c+'" enctype="multipart/form-data"></form>');var e=$("#"+b),f=$(e).clone();$(e).attr("id",d);$(e).before(f);$(e).appendTo(c);$(c).css("position","absolute");$(c).css("top","-1200px");$(c).css("left","-1200px");$(c).appendTo("body");return c},ajaxFileUpload:function(a){a=jQuery.extend({},jQuery.ajaxSettings,a);var b=(new Date).getTime(),c=jQuery.createUploadForm(b,a.fileElementId);jQuery.createUploadIframe(b,a.secureuri);var d="jUploadFrame"+b;b=
"jUploadForm"+b;a.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var e=false,f={};a.global&&jQuery.event.trigger("ajaxSend",[f,a]);var g=function(i){var j=document.getElementById(d);try{if(j.contentWindow){f.responseText=j.contentWindow.document.body?j.contentWindow.document.body.innerHTML:null;f.responseXML=j.contentWindow.document.XMLDocument?j.contentWindow.document.XMLDocument:j.contentWindow.document}else if(j.contentDocument){f.responseText=j.contentDocument.document.body?j.contentDocument.document.body.innerHTML:
null;f.responseXML=j.contentDocument.document.XMLDocument?j.contentDocument.document.XMLDocument:j.contentDocument.document}}catch(m){jQuery.handleError(a,f,null,m)}if(f||i=="timeout"){e=true;var k;try{k=i!="timeout"?"success":"error";if(k!="error"){var p=jQuery.uploadHttpData(f,a.dataType);a.success&&a.success(p,k);a.global&&jQuery.event.trigger("ajaxSuccess",[f,a])}else jQuery.handleError(a,f,k)}catch(q){k="error";jQuery.handleError(a,f,k,q)}a.global&&jQuery.event.trigger("ajaxComplete",[f,a]);
a.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop");a.complete&&a.complete(f,k);jQuery(j).unbind();setTimeout(function(){try{$(j).remove();$(c).remove()}catch(r){jQuery.handleError(a,f,null,r)}},100);f=null}};a.timeout>0&&setTimeout(function(){e||g("timeout")},a.timeout);try{c=$("#"+b);$(c).attr("action",a.url);$(c).attr("method","POST");$(c).attr("target",d);if(c.encoding)c.encoding="multipart/form-data";else c.enctype="multipart/form-data";$(c).submit()}catch(h){jQuery.handleError(a,f,
null,h)}window.attachEvent?document.getElementById(d).attachEvent("onload",g):document.getElementById(d).addEventListener("load",g,false);return{abort:function(){}}},uploadHttpData:function(a,b){var c=!b;c=b=="xml"||c?a.responseXML:a.responseText;b=="script"&&jQuery.globalEval(c);b=="json"&&eval("data = "+c);return c}});(function(a){new odesk.Class("odesk.OverlayMessage","odesk.AbstractWidget",{showNextMessage:function(b){var c;if(b.length!==0){c=this._getOptionsFromMessage(b);b=b[0].dialog(c.dialogOptions);c.fadeOut>0&&b.delay(c.fadeOut).fadeOut(function(){a(this).dialog("close")})}},_getOptionsFromMessage:function(b){var c=this,d,e;if(b.length!==0){e=b[0];d={dialogOptions:{height:"auto",width:a(".overlayMessageWidth:first",e).text(),modal:true,autoOpen:true,resizable:false,draggable:true,dialogClass:a(".overlayMessageCss:first",
e).text(),title:a(".overlayMessageTitle:first",e).text()},fadeOut:parseInt(a(".overlayMessageFadeOut:first",e).text(),10)};if(parseInt(a(".overlayMessageCloseButton:first",e).text(),10))d.dialogOptions.buttons={Close:function(){a(this).dialog("close")}};if(b.length>=2)d.dialogOptions.close=function(){b.shift();c.showNextMessage(b)};return d}},init:function(){var b=[];a(".overlayMessage").each(function(){b.push(a(this))});this.showNextMessage(b)}});new odesk.OverlayMessage("overlayMessage","#overlayMessage")})(jQuery);odesk.templates.messageThread='{{if !hideSubject}}<h1 id="subject"><div class="star{{if thread.starred}} starred{{/if}}" data-id="${thread.id}"></div>{{html thread.subject}}</h1>{{/if}}<div id="thread-posts">{{if thread.showMore}}{{tmpl(thread.firstPost) "messagePost"}}<span class="show-more">View older messages</span>{{/if}}{{each(i,m) thread.posts}}{{tmpl(m) "messagePost"}}{{/each}}{{if allowReply}}<div class="rframe post" id="inbox_reply_pane"></div>{{/if}}</div>';odesk.templates.messagePost='<div class="rframe post ${owner}{{if collapsed}} collapsed{{/if}}{{if fadeIn}} fadeIn{{/if}}"><div class="head"><span class="sender p${sender.index}">${sender.fullname}</span><div class="subject">{{html preview}}</div><span class="rcpts">to ${recepients}</span>{{if attachments && attachments.length}}<span class="attachment"></span>{{/if}}<div class="small date" title="${titleDateSent}">${dateSent}{{if canReply}}<span class="button_small reply_link" data-to="${sender_username}:${sender.fullname}">Reply to sender</span>{{/if}}</div></div><div class="content"><p class="thread-body">{{html content}}</p>{{if attachments && attachments.length}} {{tmpl({attachments: attachments}) "attachmentsList"}} {{/if}}</div></div>';
odesk.templates.attachmentsList='<ul class="attachment">${(counter = 0) || ""}{{each(i,a) attachments}}<li class="attachment"><a href="${a.url}" target="_blank">${$.trim(a.filename).length ? a.filename : ("Attachment #" + ++counter)}</a>(${odesk.string.fmtSize(a.filesize)})</li>{{/each}}</ul>';(function(a){new odesk.Class("odesk.MessageThread","odesk.AbstractWidget",{options:{template:"messageThread",messagePostTemplate:"messagePost",attachmentsListTemplate:"attachmentsList",starSelector:"#subject div.star",replySelector:"#inbox_reply_pane",renderMaxMessages:70,renderPortionSize:20,participantsList:{},threadContent:{},hideSubject:false},init:function(b,c,d){this.name=b;this.$element=a(c);this.options=a.extend(this.options,d);this.events=odesk.events.makeMap(this.name,["starred","messageCompose"]);
this.registerWidget("messageComposerWidget",new odesk.MessageComposer("messageComposerWidget",this.options.replySelector,{useDialog:false}));this.registerWidget("dialogMessageComposerWidget",new odesk.MessageComposer("dialogMessageComposerWidget",null,{useDialog:true}));var e=this;this.subscribe(this.widgets.messageComposerWidget.events.send,function(f,g){g.thread.can_reply="1";e.draw(g);e.ctx.mediator.publish(e.events.messageCompose,g)});this._render()},_render:function(){a.template(this.options.template,
odesk.templates[this.options.template]);a.template(this.options.messagePostTemplate,odesk.templates[this.options.messagePostTemplate]);a.template(this.options.attachmentsListTemplate,odesk.templates[this.options.attachmentsListTemplate])},attachmentUploadCallback:function(b){this.widgets.dialogMessageComposerWidget.isWindowOpened()?this.widgets.dialogMessageComposerWidget.attachmentUploadCallback(b):this.widgets.messageComposerWidget.attachmentUploadCallback(b)},_procParticipants:function(b){for(var c=
{},d=0,e,f=b.length;d<f;d++){e=b[d];e.fullname=e.last_name?e.first_name+"&nbsp;"+e.last_name:e.first_name||e.username;c[e.username]=e;c[e.username].index=d+1}if(c[odesk.pageConfig.AUSER.uid]){c[odesk.pageConfig.AUSER.uid].fullname="me";c[odesk.pageConfig.AUSER.uid].index=0}this.participantsList=c},_procPosts:function(b){for(var c=odesk.pageConfig.AUSER.timezone_offset+"000",d=0,e,f=b.posts.length;d<f;d++){e=b.posts[d];e.sender=this.participantsList[e.sender_username]||{name:e.sender_username,index:0};
var g,h=[];for(g in this.participantsList)g!=e.sender_username&&h.push(this.participantsList[g].fullname);e.recepients=h.join(", ");var i=odesk.date.sparse(e.created_ts+"u");e.dateSent=odesk.date.format(i,"%E",c);e.titleDateSent=odesk.date.format(i,"%W, %B %d, %Y at %h:%M%a",c);e.content=e.content||"(empty)";e.can_reply=odesk.pageConfig.AUSER.uid!=e.sender_username;e.owner="owner_"+e.sender_username.replace(/[^a-z0-9_]/gi,"_");i=false;if(this.tab=="sent"){if(e.sender_username!=odesk.pageConfig.AUSER.uid)i=
true}else if(b.tray_item.last_accessed_ts>e.created_ts)i=true;e.collapsed=i;e.canReply=b.can_reply=="1"&&(this.tab=="inbox"||this.tab=="sent")&&e.sender_username!=odesk.pageConfig.AUSER.uid&&h.length>1}},_procThread:function(b){b.starred=b.tray_item.starred=="1";if(b.posts.length>this.options.renderMaxMessages){b.showMore=true;b.allPosts=a.extend(true,[],b.posts);b.posts=[b.allPosts[0]];this._procPosts(b);b.firstPost=b.allPosts[0];b.firstPost.collapsed=false;b.lastShownIndex=b.allPosts.length-this.options.renderPortionSize;
b.posts=b.allPosts.slice(b.lastShownIndex)}this._procPosts(b);if(this.tab!="sent")b.posts[b.posts.length-1].collapsed=false;this.threadContent=b},draw:function(b,c){if(c)this.tab=c;this._procParticipants(b.thread.participants);this._procThread(b.thread);var d=[];for(var e in this.participantsList)e!=odesk.pageConfig.AUSER.uid&&d.push({id:e,name:this.participantsList[e].fullname});this.widgets.dialogMessageComposerWidget.updateRecipients(d);d=false;if(b.thread.can_reply=="1"&&(this.tab=="inbox"||this.tab==
"starred")||this.tab=="tickets"&&b.thread.do_not_reply=="0"||this.tab=="sent"&&(b.thread.type=="conversation"||b.thread.type=="ticket"&&b.thread.do_not_reply=="0"))d=true;this.$element.html(a.tmpl(this.options.template,{thread:this.threadContent,allowReply:d,hideSubject:this.options.hideSubject}));if(d)this.widgets.messageComposerWidget.update({thread:b.thread.id,title:"Reply"+(b.thread.participants.length>2?" to all":"")+":",attachmentsMaxCount:this.tab=="tickets"?1:-1},this.options.replySelector);
this._bind()},_bind:function(){var b=this;this.$element.find(this.options.starSelector).unbind("click").bind("click",function(c){c.stopPropagation();c=a(this);var d=parseInt(c.attr("data-id"),10),e=!c.hasClass("starred");c.toggleClass("starred");b.ctx.mediator.publish(b.events.starred,d,e)});a("span.reply_link").unbind("click").click({self:this},function(c){var d=a(this).attr("data-to").split(":");c=c.data.self;d={id:d.shift(),name:d.join("")};c.widgets.dialogMessageComposerWidget.openWindow({title:"Compose message",
hasBcc:false,subject:c.threadContent.subject,recipients:[d]})});a("div.rframe.post div.head, div.rframe.post div.head *").not("span.reply_link").unbind("click").bind("click",function(c){if(c.target==this){var d=a(this).parents("div.post");if(d&&d.length){d.toggleClass("collapsed");c.stopPropagation()}}});this.threadContent.showMore&&a("span.show-more").unbind("click").bind("click",function(c){if(c.target==this){b.showMore();c.stopPropagation()}})},showMore:function(){var b=this.threadContent,c;c=
b.lastShownIndex-1;var d=b.lastShownIndex-this.options.renderPortionSize,e=false,f=a("span.show-more");for(c=c;c>=d;c--){if(c<1){e=true;break}b.allPosts[c].fadeIn=true;b.posts=[b.allPosts[c]];this._procPosts(b);a.tmpl(this.options.messagePostTemplate,b.allPosts[c]).insertAfter(f).slideDown(700).removeClass("fadeIn")}if(e){b.lastShownIndex=0;f.remove()}else b.lastShownIndex=d;this._bind()},expandPosts:function(b){var c=odesk.pageConfig.AUSER.uid.toLowerCase();switch(b){case "all":this.$element.find("div.post.collapsed").removeClass("collapsed");
break;case "mine":this.$element.find("div.post.collapsed.owner_"+c.replace(/[^a-z0-9_]/gi,"_")).removeClass("collapsed");this.$element.find("div.post:not(.owner_"+c.replace(/[^a-z0-9_]/gi,"_")+")").addClass("collapsed");break;case "other":this.$element.find("div.post.collapsed:not(.owner_"+c.replace(/[^a-z0-9_]/gi,"_")+")").removeClass("collapsed");this.$element.find("div.post.owner_"+c.replace(/[^a-z0-9_]/gi,"_")).addClass("collapsed");break;case "none":this.$element.find("div.post:not(.collapsed)").addClass("collapsed");
break}},getPrevNextQueryKey:function(b){b=b=="prev"?"prev":"next";var c="";c=b=="prev"?this.threadContent.prev_thread_api:this.threadContent.next_thread_api;if((b=RegExp("/([^/]+)/"+b+"\\.json$").exec(c))!=null)return b[1];return""}});a.extend(true,odesk.MessageThread.prototype,odesk.mediator)})(jQuery);(function(a){new odesk.Class("odesk.WithdrawApplicationDialog","odesk.BaseStepDialog",{options:{selectors:{form:"form"}},form:false,init:function(b,c,d){a.extend(true,this.options,d);this._super(b,c,this.options);this._addSteps()._setProperties()._registerWidgets()},_addSteps:function(){var b=this;this.addStep({title:"Withdraw Application",buttons:{"Withdraw Application":function(){if(b.form.valid()){a(this).dialog("close");b.form.submit()}}}});return this},_setProperties:function(){this.$form=a(this.options.selectors.form,
this.$element);return this},_registerWidgets:function(){this.form=new odesk.BaseMuaForm("withdrawApplicationForm",this.$form,{loadingMessage:"Withdrawing...",fieldNames:{reason:"withdrawReason",otherReason:"withdrawOtherReason"}});this.registerWidget("withdrawApplicationForm",this.form);this.form.addReason().initValidation();return this}});a.extend(odesk.WithdrawApplicationDialog.prototype,odesk.mediator)})(jQuery);(function(a){new odesk.Class("odesk.DiscussDialog","odesk.BaseStepDialog",{options:{selectors:{form:"form"}},form:false,init:function(b,c,d){a.extend(true,this.options,d);this._super(b,c,this.options);this._addSteps()._setProperties()._registerWidgets()},_addSteps:function(){var b=this;this.addStep({title:"Send a Message",dialogClass:"buttonsAtLeft",buttons:{Send:function(){if(b.form.valid()){a(this).dialog("close");b.form.submit()}}}});return this},_setProperties:function(){this.$form=a(this.options.selectors.form,
this.$element);return this},_registerWidgets:function(){this.form=new odesk.BaseMuaForm("discussDialogForm",this.$form,{loadingMessage:"Sending..."});this.registerWidget("discussDialogForm",this.form);this.form.initValidation({rules:{message:{required:true,maxlength:5E3}},messages:{message:{required:"Value is required and can't be empty",maxlength:"Message letter should be less than {0} characters"}},errorPlacements:{message:this.form.blockPlacement}});return this}});a.extend(odesk.DiscussDialog.prototype,
odesk.mediator)})(jQuery);(function(a){new odesk.Class("odesk.DeclineOfferDialog","odesk.BaseStepDialog",{options:{selectors:{form:"form"}},init:function(b,c,d){a.extend(true,this.options,d);this._super(b,c,this.options);this._addSteps()},_addSteps:function(){var b=this;this.addStep({title:"Decline",dialogClass:"buttonsAtLeft",buttons:{Decline:function(){a(this).dialog("close");odesk.loading.show("Declining...",true);a(b.options.selectors.form,b.$element).submit()}}});return this}})})(jQuery);(function(a){new odesk.Class("odesk.DeclineInvitationDialog","odesk.BaseStepDialog",{options:{selectors:{form:"form"}},form:false,init:function(b,c,d){a.extend(true,this.options,d);this._super(b,c,this.options);this._addSteps()._setProperties()._registerWidgets()},_addSteps:function(){var b=this;this.addStep({title:"Decline",buttons:{Decline:function(){if(b.form.valid()){a(this).dialog("close");b.form.submit()}}}});return this},_setProperties:function(){this.$form=a(this.options.selectors.form,this.$element);
return this},_registerWidgets:function(){this.form=new odesk.BaseMuaForm("declineInvitationForm",this.$form,{loadingMessage:"Declining...",fieldNames:{reason:"withdrawReason",otherReason:"withdrawOtherReason"}});this.registerWidget("declineInvitationForm",this.form);this.form.addReason().initValidation();return this}});a.extend(odesk.DeclineInvitationDialog.prototype,odesk.mediator)})(jQuery);(function(a){new odesk.Class("odesk.ChangeTermsDialog","odesk.BaseStepDialog",{options:{selectors:{form:"form",applyAs:'input[name="applyAs"]',labelPaidTo:"#contractorRate-label .label",message:'textarea[name="message"]',duration:'select[name="duration"]',holders:{message:".messageHolder",rate:".rateHolder",chargeRate:".chargeRateHolder",bid:".bidHolder",chargeBid:".chargeBidHolder",upfrontPayment:".upfrontPaymentHolder",duration:".durationHolder"}},isHourlyJob:false,showTerms:false,mua:false},form:false,
init:function(b,c,d){a.extend(true,this.options,d);this._super(b,c,this.options);this._addSteps()._setProperties()._registerWidgets()._addPrivateEvents()},_addSteps:function(){var b=this;this.addStep({title:"Change Terms Step 1 of 2: Your Terms",stepSelector:".firstStep",buttons:{"Next >":a.proxy(function(){if(this.form.valid()){this.$messageLine.hide();if(this.$message.length){var c=odesk.string.nl2br(odesk.string.procEntity(this.$message.val()));c||(c="&nbsp;");this.$messageHolder.html(c);this.$messageLine.show()}this.$rateLine.hide();
this.$bidLine.hide();if(this.form.$contractorRate&&this.form.$contractorRate.length&&this.form.$employerRate&&this.form.$employerRate.length&&this.options.showTerms)if(this.options.isHourlyJob){this.$rateHolder.html("$"+this.form.$contractorRate.val()+"/hr");this.$chargeRateHolder.html(this.form.$employerRate.val());this.$rateLine.show()}else{this.$bidHolder.html("$"+this.form.$contractorRate.val());this.$chargeBidHolder.html(this.form.$employerRate.val());this.$bidLine.show()}this.$upfrontPaymentLine.hide();
if(this.form.$upfrontPayment&&this.form.$upfrontPayment.length&&!this.options.isHourlyJob&&this.options.showTerms){this.$upfrontPaymentHolder.html(this.form.$upfrontPayment.val()||0);this.$upfrontPaymentLine.show()}this.$durationLine.hide();if(this.$duration.length&&!this.options.isHourlyJob){this.$durationHolder.html(this.$duration.find("option:selected").text());this.$durationLine.show()}this.nextStep()}},this)}});this.addStep({title:"Change Terms Step 2 of 2: Review Terms",stepSelector:".secondStep",
buttons:{Done:function(){if(b.form.valid()){a(this).dialog("close");b.form.submit()}}},afterOpen:a.proxy(function(){this.$messageHolder.oTruncateBlock({limit:500,height:200}).height("auto")},this)});return this},_setProperties:function(){var b=this.options.selectors;this.$form=a(b.form,this.$element);this.$applyAs=a(b.applyAs,this.$form);this.$labelPaidTo=a(this.options.selectors.labelPaidTo);this.$message=a(b.message,this.$form);this.$duration=a(b.duration,this.$form);for(var c in b.holders){var d=
this["$"+c+"Holder"]=a(b.holders[c],this.$form);this["$"+c+"Line"]=d.closest("dd").prev("dt").andSelf()}return this},_addPrivateEvents:function(){this.$applyAs.bind("click",a.proxy(this.updateApplyAs,this));this.$applyAs.length>0&&this.updateApplyAs();return this},getApplyAsValue:function(){var b=this.$applyAs.filter(":hidden");b.length||(b=this.$applyAs.filter(":checked"));return b.length?b.val():null},_registerWidgets:function(){var b=this.name+"Form",c={applyAs:{required:true},teamWhereAC:{required:a.proxy(function(d){return this.getApplyAsValue()===
"me_ac"&&a(d).val()===""},this)},message:{required:true,maxlength:5E3}};this.options.isHourlyJob||a.extend(true,c,{duration:{required:true}});this.form=new odesk.BaseMuaForm(b,this.$form,{isFixedJob:!this.options.isHourlyJob,mua:this.options.mua});this.registerWidget(b,this.form);this.form.addRate().addUpfrontPayment().addAgreement().initValidation({rules:c,messages:{applyAs:{required:"Value is required and can't be empty"},teamWhereAC:{required:"Please select an agency"},duration:{required:"Value is required and can't be empty"},
message:{required:"Value is required and can't be empty",maxlength:"Message should be less than {0} characters"}},errorPlacements:{applyAs:this.form.blockPlacement,duration:this.form.inlinePlacement,message:this.form.blockPlacement}});return this},updateApplyAs:function(){var b=this.getApplyAsValue();this.$labelPaidTo.text((b===null?this.$applyAs.filter('[value="me_ic"]').length===0:b!=="me_ic")?"Paid to agency:":"Paid to You:")}});a.extend(odesk.ChangeTermsDialog.prototype,odesk.mediator)})(jQuery);(function(a){a.fn.oTruncateBlock=function(b){b=a.extend({},{blockSelector:false,height:"auto",limit:false,end:"..."},b);if(b.height&&b.height!=="auto"&&typeof b.height!=="number")b.height=parseInt(b.height,10)||false;if(typeof b.limit!=="number")b.limit=parseInt(b.limit,10)||false;a(this).each(function(){function c(k){for(var p=false,q,r=k.length-1;r>=0;r--){var l=k[r],o=a(l),s=l.nodeType===3;o=s?o.wrapAll("<span />").parent():o;var n=false;if(l.nodeName.toLowerCase()=="br")n=true;if(!n&&i){q=o.text().length-
(f.text().length-i);if(q<=0)n=true}if(!n&&h&&o.offset().top>m+h)n=true;if(!n)if(s){if(i)l.data=l.data.substr(0,q);if(h)for(;l.data&&d.scrollHeight>h;)l.data=l.data.replace(/(\s+\S*|\S+)$/,"");if(l.data)o.replaceWith(l);else n=true}else if(c(a.makeArray(l.childNodes))&&!l.childNodes.length)n=true;if(n){o.remove();p=true}else if(p)break}return p}var d=this,e=a(this),f=b.blockSelector?e.find(b.blockSelector):e,g=f.get(0),h=b.height,i=b.limit,j=false,m;if(h){h!=="auto"&&e.height(h);h=e.height();if(d.scrollHeight>
h){m=e.offset().top;j=true}}if(i&&f.text().length>i)j=true;if(j){e=a.makeArray(g.childNodes);if(b.end){g=a("<span />").html(b.end);if(i)i+=g.text().length;f.append(g.contents());g.remove()}c(e)}});return this}})(jQuery);(function(a){new odesk.Class("odesk.ArchiveDialog","odesk.BaseStepDialog",{options:{selectors:{form:"form"},dialogTitle:"Archive",submitButtonText:"Archive",loadingText:"Archiving..."},init:function(b,c,d){a.extend(true,this.options,d);this._super(b,c,this.options);this._setProperties()._addSteps()},_addSteps:function(){var b=this,c={title:this.options.dialogTitle,dialogClass:"buttonsAtLeft",buttons:{}};c.buttons[this.options.submitButtonText]=function(){a(this).dialog("close");odesk.loading.show(b.options.loadingText,
true);b.$form.submit()};this.addStep(c);return this},_setProperties:function(){this.$form=a(this.options.selectors.form,this.$element);return this},beforeOpen:function(){if(a("#archiveSkipWarningSet").val()==1){odesk.loading.show(this.options.loadingText,true);this.$form.submit();return false}return true}})})(jQuery);(function(a){new odesk.Class("odesk.AcceptTermsDialog","odesk.BaseStepDialog",{options:{selectors:{form:"form"},mua:false},form:false,init:function(b,c,d){a.extend(true,this.options,d);this._super(b,c,this.options);this._setSteps()._setProperties()._registerWidgets()},_setSteps:function(){var b=this;this.addStep({title:"Review Terms",buttons:{Done:function(){if(b.form.valid()){a(this).dialog("close");b.form.submit()}}}});return this},_setProperties:function(){this.$form=a(this.options.selectors.form,
this.$element);return this},_registerWidgets:function(){this.form=new odesk.BaseMuaForm("acceptTermsForm",this.$form,{loadingMessage:"Accepting...",mua:this.options.mua});this.registerWidget("acceptTermsForm",this.form);this.form.addAgreement().initValidation();return this}});a.extend(odesk.AcceptTermsDialog.prototype,odesk.mediator)})(jQuery);(function(a){new odesk.Class("odesk.AcceptInterviewDialog","odesk.ChangeTermsDialog",{init:function(b,c,d){a.extend(true,this.options,d);this._super(b,c,this.options);this._setStepTitles()},_setStepTitles:function(){this.options.steps[0].title="Accept Interview Step 1 of 2: Your Message and Terms";this.options.steps[1].title="Accept Interview Step 2 of 2: Review Terms"},beforeOpen:function(){return!a("#phone_verification_dialog .current-page").length}});a.extend(odesk.AcceptInterviewDialog.prototype,
odesk.mediator)})(jQuery);(function(a){a.fn.autogrow=function(b){return this.each(function(){new a.autogrow(this,b)})};a.autogrow=function(b,c){this.options=c||{};this.interval=this.dummy=null;this.line_height=this.options.lineHeight||parseInt(a(b).css("line-height"));this.min_height=this.options.minHeight||parseInt(a(b).css("min-height"));this.max_height=this.options.maxHeight||parseInt(a(b).css("max-height"));this.textarea=a(b);if(isNaN(this.line_height))this.line_height=0;this.init()};a.autogrow.fn=a.autogrow.prototype=
{autogrow:"1.2.2"};a.autogrow.fn.extend=a.autogrow.extend=a.extend;a.autogrow.fn.extend({init:function(){var b=this;this.textarea.css({overflow:"hidden",display:"block"});this.textarea.bind("focus",function(){b.startExpand()}).bind("blur",function(){b.stopExpand()});this.checkExpand()},startExpand:function(){var b=this;this.interval=window.setInterval(function(){b.checkExpand()},400)},stopExpand:function(){clearInterval(this.interval)},checkExpand:function(){if(this.dummy==null){this.dummy=a("<div></div>");
this.dummy.css({"font-size":this.textarea.css("font-size"),"font-family":this.textarea.css("font-family"),width:this.textarea.css("width"),padding:this.textarea.css("padding"),"line-height":this.line_height+"px","overflow-x":"hidden",position:"absolute",top:0,left:-9999}).appendTo("body")}var b=this.textarea.val().replace(/(<|>)/g,"");b=$.browser.msie?b.replace(/\n/g,"<BR>new"):b.replace(/\n/g,"<br>new");if(this.dummy.html()!=b){this.dummy.html(b);if(this.max_height>0&&this.dummy.height()+this.line_height>
this.max_height)this.textarea.css("overflow-y","auto");else{this.textarea.css("overflow-y","hidden");if(this.textarea.height()<this.dummy.height()+this.line_height||this.dummy.height()<this.textarea.height())this.textarea.animate({height:this.dummy.height()+this.line_height+"px"},100)}}}})})(jQuery);(function(a){odesk.pageController=a.extend(odesk.abstractPageController,{options:{selectors:{acceptInterviewDialog:"#acceptInterviewDialog",acceptInterviewLink:"#acceptInterviewFirstStepLink",acceptTermsDialog:"#acceptTermsDialog",acceptTermsLink:"#acceptTermsLink",declineOfferDialog:"#declineOfferDialog",declineOfferLink:"#declineOfferLink",archiveDialog:"#archiveDialog",archiveLink:"#archiveLink",ignoreDialog:"#ignoreDialog",ignoreLink:"#ignoreLink",discussDialog:"#discussDialog",discussLink:"#discussLink",
declineInvitationDialog:"#declineInvitationDialog",declineInvitationLink:"#declineInvitationLink",withdrawApplicationDialog:"#withdrawApplicationDialog",withdrawApplicationLink:"#withdrawApplicationLink",changeTermsDialog:"#changeTermsDialog",changeTermsLink:"#changeTermsLink",sentMessages:"#sentMessages",flaggingWidget:"#flaggingWidget"},isHourlyJob:false,showTerms:false,mua:false,flaggingWidgetData:false,threadData:false},init:function(){this._setProperties()._registerWidgets()._addEvents()},_setProperties:function(){if(this.config.pageVars){a.extend(true,
this.options,this.config.pageVars);delete this.config.pageVars}a.extend(true,this.options,this.config);return this},_registerWidgets:function(){this.registerWidget({acceptInterviewDialog:new odesk.AcceptInterviewDialog("acceptInterviewDialog",this.options.selectors.acceptInterviewDialog,{dialog:{width:720,dialogClass:"wizard"},isHourlyJob:this.options.isHourlyJob,showTerms:this.options.showTerms,mua:this.options.mua}),acceptTermsDialog:new odesk.AcceptTermsDialog("acceptTermsDialog",this.options.selectors.acceptTermsDialog,
{selectors:{openLink:this.options.selectors.acceptTermsLink},mua:this.options.mua}),declineOfferDialog:new odesk.DeclineOfferDialog("declineOfferDialog",this.options.selectors.declineOfferDialog,{selectors:{openLink:this.options.selectors.declineOfferLink}}),archiveDialog:new odesk.ArchiveDialog("archiveDialog",this.options.selectors.archiveDialog,{selectors:{openLink:this.options.selectors.archiveLink}}),ignoreDialog:new odesk.ArchiveDialog("ignoreDialog",this.options.selectors.ignoreDialog,{selectors:{openLink:this.options.selectors.ignoreLink},
dialogTitle:"Ignore",submitButtonText:"Ignore"}),discussDialog:new odesk.DiscussDialog("discussDialog",this.options.selectors.discussDialog,{selectors:{openLink:this.options.selectors.discussLink}}),declineInvitationDialog:new odesk.DeclineInvitationDialog("declineInvitationDialog",this.options.selectors.declineInvitationDialog,{selectors:{openLink:this.options.selectors.declineInvitationLink}}),withdrawApplicationDialog:new odesk.WithdrawApplicationDialog("withdrawApplicationDialog",this.options.selectors.withdrawApplicationDialog,
{selectors:{openLink:this.options.selectors.withdrawApplicationLink}}),changeTermsDialog:new odesk.ChangeTermsDialog("changeTermsDialog",this.options.selectors.changeTermsDialog,{selectors:{openLink:this.options.selectors.changeTermsLink},dialog:{width:720,dialogClass:"wizard"},isHourlyJob:this.options.isHourlyJob,showTerms:this.options.showTerms,mua:this.options.mua})});this.options.flaggingWidgetData&&this.registerWidget("flagging",new odesk.Flagging(this.options.selectors.flaggingWidget,{groupId:this.options.flaggingWidgetData.groupId,
userId:this.options.flaggingWidgetData.userId}));if(this.options.threadData){this.registerWidget("messageThreadWidget",new odesk.MessageThread("messageThreadWidget",this.options.selectors.sentMessages,{hideSubject:true}));this.widgets.messageThreadWidget.draw({thread:this.options.threadData},"sent")}return this},_addEvents:function(){a("#applicationActionsBox a.hasTip").obt();a("#unarchiveDirectLink").click(function(){odesk.loading.show("Unarchiving...",true);return true});a(".showHide").disableSelection().bind("click",
function(){a(this).toggleClass("shown hidden").next().slideToggle("fast")});a(this.options.selectors.acceptInterviewLink).bind("click",a.proxy(function(){var b=a("#phone_verification_dialog .current-page:first");b.length?a("#phone_verification_dialog").pvWizard(b[0].id):this.widgets.acceptInterviewDialog.open()},this));return this},attachmentUploadCallback:function(b){this.widgets.messageThreadWidget.attachmentUploadCallback(b)}})})(jQuery);
